<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.ff31de0ff">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Douglas Caina Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Douglas Caina Blog Atom Feed">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Anonymous+Pro&display=swap">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:200,400,800&display=swap"><title data-react-helmet="true">Creating a featureToggle directive in Angular. | Douglas Caina</title><meta data-react-helmet="true" property="og:title" content="Creating a featureToggle directive in Angular. | Douglas Caina"><meta data-react-helmet="true" name="description" content="Photo by Anthony Intraversato on Unsplash"><meta data-react-helmet="true" property="og:description" content="Photo by Anthony Intraversato on Unsplash"><meta data-react-helmet="true" property="og:url" content="http://caina.dev.br/blog/2019/10/09/angular-simple-feature-toggle-that-works-outside-of-the-route"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><link data-react-helmet="true" rel="shortcut icon" href="/img/cool-lama.svg"><link data-react-helmet="true" rel="canonical" href="http://caina.dev.br/blog/2019/10/09/angular-simple-feature-toggle-that-works-outside-of-the-route"><link data-react-helmet="true" rel="alternate" href="http://caina.dev.br/blog/2019/10/09/angular-simple-feature-toggle-that-works-outside-of-the-route" hreflang="en"><link data-react-helmet="true" rel="alternate" href="http://caina.dev.br/blog/2019/10/09/angular-simple-feature-toggle-that-works-outside-of-the-route" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.898aeb41.css">
<link rel="preload" href="/assets/js/runtime~main.8dd1bcbe.js" as="script">
<link rel="preload" href="/assets/js/main.dcb837ae.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/cool-lama.svg" alt="Douglas caina - logo image" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/cool-lama.svg" alt="Douglas caina - logo image" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Caina</strong></a><a class="navbar__item navbar__link" href="/docs/a-list-of-usefull-links">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/cool-lama.svg" alt="Douglas caina - logo image" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/cool-lama.svg" alt="Douglas caina - logo image" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Caina</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/a-list-of-usefull-links">Docs</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/blog">Blog</a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><div class="col col--3"><div class="sidebar_2ahu thin-scrollbar"><h3 class="sidebarItemTitle_2hhb">Recent posts</h3><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/06/19/angular-highlight-component-scratch">Simple Angular search highlighting text without dependencies</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/02/12/angular-testing-without-before-each">Angular TDD without BeforeEach, and why its a good idea.</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/01/05/front-end-weight-of-node-modules">The weight of a dependency in a modern SPA application</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2019/11/20/frontend-angular-react-architecture-scales">Front-end for Single page applications(Angular, React, Vue) that scales with your team and how to makes sense of it.</a></li><li class="sidebarItem_2UVv"><a aria-current="page" class="sidebarItemLink_1RT6 sidebarItemLinkActive_12pM" href="/blog/2019/10/09/angular-simple-feature-toggle-that-works-outside-of-the-route">Creating a featureToggle directive in Angular.</a></li></ul></div></div><main class="col col--7"><article><header><h1 class="margin-bottom--sm blogPostTitle_GeHD">Creating a featureToggle directive in Angular.</h1><div class="margin-vert--md"><time datetime="2019-10-09T00:00:00.000Z" class="blogPostDate_fNvV">October 9, 2019 Â· 3 min read</time></div><div class="avatar margin-vert--md"><div class="avatar__intro"></div></div></header><div class="markdown"><p><img alt="Photo by Anthony Intraversato on Unsplash" src="/assets/images/airplane-004363389141148c3c95fc90dd14ec5f.jpg"></p><p>This is kind of odd, but my PO wanted to have a feature toggle so our users would not see the new stuff but we want to test this thing against the real world. So let&#x27;s build it because we libraries are way too dangerous these days ðŸ‘».</p><blockquote><p>Our feature toggle is going to rely on the browser query parameters to work, so in order to enable a feature, we&#x27;ll have to navigate with the following URL: <code>localhost:4200?feature=search-bar</code></p></blockquote><p>To use our feature toggle, we are going to create a directive, that we can easily attach to the component we want to toggle: <code>&lt;app-search-bar *featureToggle=&quot;&#x27;search-bar&#x27;&quot; /&gt;</code>.</p><p>the <em>first</em> thing that we need is to store every path parameter as features so we can toggle the hell out of our app. for this we are going to create a resolver:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly angular2"><div tabindex="0" class="prism-code language-angular2 codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">@Injectable({providedIn: &#x27;root&#x27;})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">export class FeatureResolver implements Resolve&lt;void&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  constructor(private _featureService: FeatureService) {}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  public resolve(route: ActivatedRouteSnapshot, state: RouterStateSnapshot): void {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    const feature = route.queryParamMap.get(&#x27;feature&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    if (feature != null) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      this._featureService.addAvailableFeature(feature);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>and this resolver is going to be used in our route as the route resolver:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> routes</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token maybe-class-name">Routes</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    path</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    component</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token maybe-class-name">DashboardComponent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    resolve</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token maybe-class-name">FeatureResolver</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// &lt;- thats the thing</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>the idea here is that we can enable these features by route! Every time we enter the route we&#x27;ll take the path parameters and store them in service. I mean, a singleton service! Be aware of it because if you provide it in the wrong place you&#x27;ll not get the values from the route.</p><p>and this service is looking something like this:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly angular2"><div tabindex="0" class="prism-code language-angular2 codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">@Injectable()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">export class FeatureService {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  private featuresSource = new BehaviorSubject&lt;Array&lt;String&gt;&gt;([]);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  public $features = this.featuresSource.asObservable();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  public addAvailableFeature(feature: string): void {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    this.featuresSource.next([...this.featuresSource.value, feature])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>In case you&#x27;ve never seen something like this pattern, this is an observable pattern, maybe we can talk about it later, but the advantage of this thing is that NO ONE TOUCH IN MY OBSERVABLE ðŸ‘º. You can read but not send data. </p><blockquote><p>Why the hell do we need this? as we are relying on the route to getter the path parameter, if the component you want to test is outside, like a header or a footer, it would not work, so we handle it using promises.</p></blockquote><p>and to finish, we just need the directive, and it&#x27;s as simple as:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly angular2"><div tabindex="0" class="prism-code language-angular2 codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">@Directive({selector: &#x27;[featureToggle]&#x27;})</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">export class FeatureToggleDirective implements OnInit {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  @Input(&#x27;featureToggle&#x27;) feature: string;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  constructor(private featureService: FeatureService,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    private templateRef: TemplateRef&lt;any&gt;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    private viewContainer: ViewContainerRef</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ) {}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ngOnInit(): void {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    this.featureService.$features.subscribe(features =&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      if(features.includes(this.feature)) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        this.viewContainer.createEmbeddedView(this.templateRef);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        } else {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          this.viewContainer.clear();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    })</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The problem that I had is that the feature to be toggled is in the header, the header is outside of the route so the directive is resolved first, and the route would only collect the &quot;features to be toggled&quot; when angular finish to inject the route, to be worst, my route is being lazy loaded, so it takes even more time. This subscription actually solved a lot of problems.</p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/angular">angular</a><a class="margin-horiz--sm" href="/blog/tags/front-end">front-end</a></div></footer></article><div></div><div class="margin-vert--xl"><nav class="pagination-nav" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/2019/11/20/frontend-angular-react-architecture-scales"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Â« Front-end for Single page applications(Angular, React, Vue) that scales with your team and how to makes sense of it.</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2019/09/21/how-to-push-to-github-unauthenticated-in-pipeline"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Pushin to github in a pipeline without loging. Â»</div></a></div></nav></div></main><div class="col col--2"><div class="tableOfContents_35-E thin-scrollbar"></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/a-list-of-usefull-links">Useful links</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/videos-about-front-end">Videos About Front</a></li></ul></div><div class="col footer__col"><div class="footer__title">Code</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/caina" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github</a></li><li class="footer__item"><a href="https://gitlab.com/caina" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitLab</a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items"><li class="footer__item"><a href="https://medium.com/@douglascaina" target="_blank" rel="noopener noreferrer" class="footer__link-item">Medium</a></li><li class="footer__item"><a href="https://www.linkedin.com/in/douglascaina/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Linkedin</a></li><li class="footer__item"><a href="https://www.facebook.com/caina27" target="_blank" rel="noopener noreferrer" class="footer__link-item">Facebook</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">No Copyright Â© 2021. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.8dd1bcbe.js"></script>
<script src="/assets/js/main.dcb837ae.js"></script>
</body>
</html>